#VRML V2.0 utf8

WorldInfo {
	title "3D arrow"
	info ["Eva Pešková"]
}

PROTO Arrow3D [			  
	exposedField SFColor dColor 0.2 0.4 0.8 
	exposedField SFInt32 visible 1
]{
	Group {
		children [
			Switch {
				choice [
					DEF	ArrowShapeHead Shape {
						 appearance	Appearance {
							 material Material {
								 diffuseColor IS dColor
							 }
						 }
						 geometry Cone {
							 height	1
							 bottomRadius 0.5
							 bottom	FALSE
							 side TRUE
						 }
					}
					DEF	ArrowShapeBody Shape {
						appearance Appearance {
							material Material {
								diffuseColor IS	dColor
							}
						}
						geometry Cylinder {
							height 2
							radius 0.2
							bottom FALSE
							side TRUE
						}
					}		
				    DEF	ArrowShape Transform {
						children [
							USE	ArrowShapeBody
							Transform {
								children [
									USE	ArrowShapeHead
								]
								translation	0 1.2 0
							}
						]
						rotation	0 0 1 3.1			
					}
				]
			}
			Switch {
				whichChoice	IS visible
				choice [
					Group {}
					USE	ArrowShape					
				]
			}
			
		]		
	}
}		  

PROTO Arrow3DBlinker [		 
	eventIn	SFBool showIt
]{
	Group {
		children [
			Switch {
				choice [
					DEF	MoveSensor TimeSensor {
						cycleInterval 1
						loop TRUE
						enabled	TRUE
					}
					DEF BlinkSensor TimeSensor {
						
						#how much the interval should take
						cycleInterval 3	

						#for repeat forever
						loop TRUE
			
					}
					DEF PositionMover PositionInterpolator	{
						key	[0, 0.5, 1]
						keyValue [ 0 0 0, 0 -0.2 0, 0 0 0]
					}		 

					DEF	BlinkerScript Script {
						eventIn	SFFloat blinker
						eventOut SFInt32 visible
						url	"javascript:
							var time0 = true;
							function blinker( fraction ){
								if ( fraction > 0.5 ) {	 
									visible = 1;
								}
								else
								{
									visible = 0;
								}
							}
						"
					}
					DEF	BlinkingArrowPos Transform
					   {
						   children	DEF BlinkingArrow Arrow3D {
								visible	1
							}				  
					   } 
				]
			}
			USE	BlinkingArrowPos
		]

		ROUTE MoveSensor.fraction_changed TO PositionMover.set_fraction
		ROUTE PositionMover.value_changed TO BlinkingArrowPos.translation
		ROUTE BlinkSensor.fraction_changed TO BlinkerScript.blinker
		ROUTE BlinkerScript.visible	TO	BlinkingArrow.visible
	}
} 