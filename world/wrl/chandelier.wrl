#VRML V2.0 utf8

WorldInfo {
	title "Chandelier"
	info ["Filip BÃ¡rtek"]
}

# http://www.bellrock.org.uk/lighthouse/lighthouse_lightroom.htm
# http://www.bellrock.org.uk/lighthouse/lighthouse_courses.htm

EXTERNPROTO	BarRoundProto [
	field SFVec3f scale
	exposedField SFColor diffuseColor
	field SFBool bottom
	field SFBool top
]
"barround.wrl#BarRound"

PROTO LightCone [
	exposedField SFColor color 1 1 0
	exposedField SFFloat coneTransparency 0.7
	exposedField SFVec3f coneScale 100 100 100
	exposedField SFBool pointLightOn TRUE
	# Z+: forward
	exposedField SFVec3f pointLightLocation 0 0 0.5
]{
	Group {
		children [
			Transform {
				children [
					Transform	{
						children [
							Transform	{
								children [
									Transform {
										children [
											Shape {
												appearance Appearance {
													material Material {
														transparency IS	coneTransparency
														emissiveColor IS color
														diffuseColor 0 0 0
														shininess 0
														specularColor 0 0 0
														ambientIntensity 0
													}
												}
												geometry Cone {
													bottom FALSE
												}
											}
										]
										translation	0 -1 0
									}
								]
								# 270 degrees
								rotation 1 0 0 4.71
							}
						]
						# 22.5 * 2 degrees beam angle
						scale 0.21 0.21 1
					}
				]
				scale IS coneScale
			}
			PointLight {
				color IS color
				location IS	pointLightLocation
				radius 10
				attenuation	0 0 1
				on IS pointLightOn
			}
		]
	}
}

Switch {
	choice [

		DEF	Reflector Inline {
			url	["reflector.wrl"]
		}

		DEF	Rod BarRoundProto {
			bottom TRUE
			top	TRUE
			scale 0.02 1 0.02
			diffuseColor 0.0 0.1 0.2
		}

		DEF	RodHorizontal Transform	{
			children [
				USE	Rod
			]
			rotation 0 0 1 1.57
		}

		DEF	Line2 Group {
			children [
				Transform {
					children [
						USE	Reflector
					]
					translation	-0.3175 0 0
				}
				Transform {
					children [
						USE	Reflector
					]
					translation	0.3175 0 0
				}
			]
		}

		DEF	Line2Side5 Group {
			children [
				USE	Line2
				Transform {
					children [
						USE	RodHorizontal
					]
					scale 0.6350 1 1
				}
			]
		}

		DEF	Line2Side7 Group {
			children [
				USE	Line2
				Transform {
					children [
						USE	RodHorizontal
					]
					scale 1.2700 1 1
				}
			]
		}

		DEF	Line3 Group {
			children [
				Transform {
					children [
						USE	Reflector
					]
					translation	-0.6350 0 0
				}
				USE	Reflector
				Transform {
					children [
						USE	Reflector
					]
					translation	0.6350 0 0
				}
				Transform {
					children [
						USE	RodHorizontal
					]
					scale 1.2700 1 1
				}
			]
		}

		DEF	InclinedRod Transform {
			children Transform {
				children USE Rod
				translation	0 0.5 0
			}
			# rod length:
			# rod length ^ 2 = line distance ^ 2 + (reflector in line distance / 2) ^ 2
			# line distance = 0.64
			# reflector in line distance = 0.6350
			# sqrt((0.6350 / 2) ^ 2 + 0.64 ^ 2)
			# approx. 0.7144
			scale 1 0.7144 1
			# rod angle:
			# tg(rod angle) = (reflector in line distance / 2) / line distance
			# atg((0.6350 / 2) / 0.64)
			# approx. 0.46
			rotation 0 0 1 0.46
		}

		DEF	Side7 Group {
			children [
				Transform {
					children [
						USE	Line2Side7
					]
					translation	0 -0.64 0
				}
				USE	Line3
				Transform {
					children [
						USE	Line2Side7
					]
					translation	0 0.64 0
				}
				Transform {
					children USE InclinedRod
					translation	0 -0.64 0
				}
				Transform {
					children USE InclinedRod
					scale -1 1 1
					translation	0 -0.64 0
				}
				Transform {
					children USE InclinedRod
					scale 1 -1 1
					translation	0 0.64 0
				}
				Transform {
					children USE InclinedRod
					scale -1 -1 1
					translation	0 0.64 0
				}
				LightCone {
					color 1 1 0
				}
			]
		}

		# http://www.bellrock.org.uk/lighthouse/lighthouse_lightroom.htm
		# "panes of red-coloured glass were placed in front of each of the reflectors on the minor sides"
		DEF	RedPane Shape	{
			appearance Appearance {
				material Material {
					diffuseColor 1 0 0
					transparency 0.5
				}
			}
			geometry Box {
				size 1 1 0.00635
			}
		}

		DEF	Side5 Group {
			children [
				Transform {
					children [
						USE	Line2Side5
					]
					translation	0 -0.64 0
				}
				USE	Reflector
				Transform {
					children [
						USE	Line2Side5
					]
					translation	0 0.64 0
				}
				LightCone {
					color 1 0 0
					coneTransparency 0.8
				}
				Transform {
					children [
						USE	RedPane
					]
					scale 1 2 1
					translation	0 0 0.4175
				}
			]
		}

		DEF	Chandelier Group {
			children [
				Transform {
					children [
						USE	Side7
					]
					translation	0 0 0.3175
				}
				Transform {
					children [
						USE	Side7
					]
					rotation 0 1 0 3.14
					translation	0 0 -0.3175
				}
				Transform {
					children [
						USE	Side5
					]
					rotation 0 1 0 1.57
					translation	0.6350 0 0
				}
				Transform {
					children [
						USE	Side5
					]
					rotation 0 1 0 4.71
					translation	-0.6350 0 0
				}
			]
		}

	]
}

USE	Chandelier
